# Nad Racer Server Environment Example

# App
PORT=3001
NODE_ENV=production

# CORS / Frontend
FRONTEND_URL=https://your-frontend.example.com
CORS_ALLOWED_ORIGINS=https://your-frontend.example.com

# Content Security Policy - DISABLED
# CSP is disabled in server.js for Privy compatibility
# This avoids conflicts with Privy's Google Tag Manager analytics

# Privy (if applicable)
PRIVY_APP_ID=
PRIVY_SECRET_KEY=

# Game / Contracts
GAME_ADDRESS=0xYourGameAddress

# Monad API
MONAD_APP_ID=
MONAD_USERNAME_API=https://www.monadclip.fun

# RPC
MONAD_RPC_URL=https://testnet-rpc.monad.xyz
MONAD_BLOCK_EXPLORER_URL=https://testnet.monadexplorer.com

# Leaderboard API (server proxy)
LEADERBOARD_API_URL=https://www.monadclip.fun/api/leaderboard

# Server signing secret (required)
# Use a strong random 64-hex-character value in production
SCORE_HMAC_SECRET=REPLACE_WITH_RANDOM_64_HEX

# Blockchain wallet (required for score submissions)
PRIVATE_KEY=your_private_key_here

# General rate limits (tune for prod)
RATE_LIMIT_GENERAL_WINDOW_MS=900000
RATE_LIMIT_GENERAL_MAX=100

# Submit rate limits (tune for prod)
RATE_LIMIT_SCORE_WINDOW_MS=60000
RATE_LIMIT_SCORE_MAX=10

# Score validation
MAX_SCORE_LIMIT=1000000
MAX_TRANSACTIONS_LIMIT=10000
MAX_REASONABLE_SCORE=10000
SUSPICIOUS_SCORE_THRESHOLD=100000

# Per-wallet rate limiting
WALLET_SUBMISSIONS_PER_HOUR=20
WALLET_RATE_RESET_MS=3600000

# Session management (new flow tuning)
SESSION_TTL_MS=600000
NONCE_TTL_MS=120000
MAX_CLOCK_SKEW_MS=120000
MIN_NONCE_INTERVAL_MS=3000
MIN_SUBMIT_INTERVAL_MS=3000
QUEUE_BACKPRESSURE_RATIO=0.8

# Gameplay proof validation (legacy - kept for compatibility)
MIN_COIN_INTERVAL_MS=250
MAX_COINS_PER_MIN=180

# ==============================================
# HIGH-PRIORITY ANTI-SPAM FIXES (NEW)
# ==============================================

# Session Duration Requirements
MIN_SESSION_DURATION_MS=5000         # 5 seconds minimum gameplay before submit (reasonable for testing)
MIN_TIME_TO_FIRST_COIN_MS=500        # 0.5 seconds delay before first coin (allows immediate gameplay)

# Score Rate Validation
MAX_SCORE_PER_SECOND=10              # Maximum realistic score per second

# Nonce Limits per Session
MAX_NONCES_PER_SESSION=5             # Maximum nonce requests per session

# Start-Game Rate Limiting per Wallet
START_GAME_RATE_WINDOW_MS=300000     # 5 minute rolling window
MAX_START_GAMES_PER_WINDOW=10        # Maximum game starts per wallet per window

# Tightened Coin Collection Timing
MIN_REALISTIC_COIN_INTERVAL_MS=100   # Match client's 100ms timestamp rounding (allows fastest legitimate gameplay)
MAX_REALISTIC_COINS_PER_MIN=200      # Maximum realistic coins per minute (allows skilled players)

# ==============================================
# PRODUCTION vs DEVELOPMENT BEHAVIOR
# ==============================================
# 
# The following settings automatically adapt based on NODE_ENV:
#
# In DEVELOPMENT (NODE_ENV != "production"):
# - Rate limits are more permissive
# - Authentication bypasses localhost 
# - WALLET_SUBMISSIONS_PER_HOUR uses configured value
# - General/score/start-game/nonce limits at full values
#
# In PRODUCTION (NODE_ENV = "production"):
# - Rate limits are 30-50% stricter automatically
# - No authentication bypasses
# - WALLET_SUBMISSIONS_PER_HOUR reduced to 50% of dev value
# - General rate limits reduced by 30%
# - Score submission limits reduced by 50%
# - Start-game limits reduced by 50%
# - Nonce limits reduced by 50%
